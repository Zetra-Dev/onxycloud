 <!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <!-- 
        ONXY CLOUD SYSTEM V3
        Architecture: P2P Mesh Network (Client-Side)
        Kernel: React 18 + PeerJS
        UI: Tailwind + Custom Glassmorphism
        
        COPYRIGHT (C) 2024-2025 ONXY SYSTEMS
        DO NOT DISTRIBUTE WITHOUT AUTHORIZATION
    -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#030303">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ONXY CLOUD | ONLY FOR DEVS</title>
    
    <!-- CARREGAMENTO DE N√öCLEOS E BIBLIOTECAS DE ALTA PERFORMANCE -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

    <!-- ESTILIZA√á√ÉO AVAN√áADA DO SISTEMA -->
    <style>
        /* IMPORTA√á√ÉO DE FONTES FUTURISTAS */
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@300;400;500;700&family=Inter:wght@400;600;800;900&display=swap');
        
        :root { 
            /* PALETA DE CORES DIN√ÇMICA (Ser√° sobrescrita pelo JS) */
            --brand: #a855f7; 
            --brand-glow: rgba(168, 85, 247, 0.5);
            --bg: #030303; 
            --surface: #0a0a0a;
            --surface-hover: #121212;
            --text-main: #ffffff;
            --text-muted: #888888;
            --border: rgba(255, 255, 255, 0.08);
            
            /* VARI√ÅVEIS DE AMBIENTE IOS/ANDROID */
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        /* RESET E COMPORTAMENTO BASE */
        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
            background: var(--bg);
            color: var(--text-main);
            font-family: 'Plus Jakarta Sans', sans-serif;
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            padding-top: var(--safe-top);
            transition: background-color 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* EFEITOS DE FUNDO (NOISE & SCANLINES) */
        .noise-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.7' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.05'/%3E%3C/svg%3E");
            opacity: 0.4; pointer-events: none; z-index: 1; mix-blend-mode: overlay;
        }

        .scanlines {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.1));
            background-size: 100% 4px;
            pointer-events: none; z-index: 2; opacity: 0.3;
        }

        /* UTILIT√ÅRIOS DE VIDRO (GLASSMORPHISM V3) */
        .glass { 
            background: rgba(3, 3, 3, 0.8); 
            backdrop-filter: blur(20px); 
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border); 
            z-index: 50; 
        }

        .glass-panel { 
            background: rgba(255, 255, 255, 0.02); 
            border: 1px solid rgba(255, 255, 255, 0.06); 
            backdrop-filter: blur(16px); 
            -webkit-backdrop-filter: blur(16px);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        .glass-panel:hover {
            border-color: rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.03);
        }

        /* SCROLLBAR INVIS√çVEL MAS FUNCIONAL */
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* SCROLLBAR ESTILIZADA PARA EDITOR */
        .custom-scroll::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: var(--brand); }

        /* ELEMENTOS DE UI ESPEC√çFICOS */
        .suggestion-box {
            position: absolute; bottom: 90px; left: 16px; right: 16px; 
            background: #0f0f0f; border: 1px solid var(--brand);
            border-radius: 12px; z-index: 9999; box-shadow: 0 20px 50px rgba(0,0,0,0.9);
            max-height: 200px; overflow-y: auto;
            animation: slideUp 0.2s ease-out;
        }

        .suggestion-item { 
            padding: 12px 16px; 
            font-family: 'JetBrains Mono', monospace; 
            font-size: 11px; cursor: pointer; 
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.03);
            transition: all 0.1s;
        }
        .suggestion-item:hover { background: var(--brand); color: #000; font-weight: 700; }
        .suggestion-item:last-child { border-bottom: none; }

        /* RODAP√â DE NAVEGA√á√ÉO */
        .nav-fixed { 
            position: fixed; bottom: 0; left: 0; right: 0; height: 85px; 
            z-index: 100; border-top: 1px solid var(--border); 
            background: rgba(3,3,3,0.95); backdrop-filter: blur(25px); 
            padding-bottom: var(--safe-bottom);
        }
        
        /* TAGS E LABELS */
        .tag { font-size: 9px; font-weight: 800; padding: 2px 8px; border-radius: 4px; text-transform: uppercase; background: rgba(255,255,255,0.05); color: var(--text-muted); border: 1px solid rgba(255,255,255,0.05); }
        .tag-active { background: var(--brand); color: #000; border-color: var(--brand); box-shadow: 0 0 10px var(--brand-glow); }
        
        /* LOGS DO SISTEMA */
        .log-line { font-family: 'JetBrains Mono', monospace; font-size: 10px; padding: 4px 0; border-bottom: 1px solid rgba(255,255,255,0.02); display: flex; gap: 8px; }
        .log-time { color: #555; user-select: none; }
        .log-content { color: #aaa; }
        
        /* SWITCH UI */
        .switch-ui { width: 40px; height: 20px; background: #222; border-radius: 20px; position: relative; cursor: pointer; transition: 0.3s; border: 1px solid rgba(255,255,255,0.1); }
        .switch-ui.active { background: var(--brand); border-color: var(--brand); }
        .switch-ui::after { content: ''; position: absolute; width: 16px; height: 16px; background: white; border-radius: 50%; top: 1px; left: 1px; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .switch-ui.active::after { left: 21px; }

        /* ANIMA√á√ïES GLOBAIS */
        @keyframes scan { 0% { transform: translateY(-100%); } 100% { transform: translateY(100%); } }
        .scanner { position: relative; overflow: hidden; }
        .scanner::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 2px; background: var(--brand); opacity: 0.5; animation: scan 3s linear infinite; box-shadow: 0 0 10px var(--brand); }

        @keyframes bootPulse { 0% { opacity: 0.3; } 50% { opacity: 1; } 100% { opacity: 0.3; } }
        @keyframes slideUp { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
        
        /* BOOT SCREEN */
        .boot-screen { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; font-family: 'JetBrains Mono', monospace; }
        .boot-loader { width: 200px; height: 2px; background: #111; margin-top: 20px; position: relative; overflow: hidden; }
        .boot-bar { position: absolute; top: 0; left: 0; height: 100%; background: var(--brand); animation: bootProgress 2.5s ease-in-out forwards; width: 0%; box-shadow: 0 0 15px var(--brand); }
        @keyframes bootProgress { 0% { width: 0%; } 40% { width: 30%; } 70% { width: 70%; } 100% { width: 100%; } }
        
        /* TEXTAREA DO EDITOR */
        .editor-area {
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            line-height: 1.6;
            caret-color: var(--brand);
            background: transparent;
            color: #d4d4d4;
            tab-size: 2;
        }
        .editor-area:focus { outline: none; }
        .editor-area::selection { background: var(--brand-glow); color: white; }

        /* RESPONSIVIDADE EM IFRAMES E GATEWAY */
        .gateway-container { width: 100vw; height: 100vh; background: #000; position: relative; overflow: hidden; }
        .gateway-iframe { width: 100%; height: 100%; border: none; background: #fff; }
    </style>
</head>
<body>
    <!-- ELEMENTOS VISUAIS DE FUNDO -->
    <div class="noise-layer"></div>
    <div class="scanlines"></div>
    
    <!-- PONTO DE MONTAGEM DO REACT -->
    <div id="root"></div>
<audio id="silent-audio" loop><source src="https://raw.githubusercontent.com/anars/blank-audio/master/10-seconds-of-silence.mp3" type="audio/mp3"></audio>
    <!-- AUDIO DE KEEPALIVE (SILENCIOSO E OTIMIZADO) -->
    <!-- Substitu√≠do por oscilador via JS para garantir execu√ß√£o em background -->

    <script type="text/babel">
        /**
         * ONXY CLOUD KERNEL V3
         * * Estrutura do Sistema:
         * 1. Router Logic: Decide se monta a IDE ou o GATEWAY baseado na URL.
         * 2. Gateway: Cliente leve P2P que apenas consome e renderiza.
         * 3. IDE: Ambiente de desenvolvimento completo (Dashboard, Editor, Deploy).
         */

        const { useState, useEffect, useMemo, useRef, useCallback } = React;

        // --- CONSTANTES DO SISTEMA E TEMAS ---
        const THEMES = {
            VOID: { name: 'VOID PRO', brand: '#a855f7', bg: '#030303', surface: '#0a0a0a' },
            COBALT: { name: 'COBALT X', brand: '#3b82f6', bg: '#010409', surface: '#050a14' },
            AMBER: { name: 'AMBER OS', brand: '#f59e0b', bg: '#080501', surface: '#140c02' },
            CRIMSON: { name: 'RED ALERT', brand: '#dc2626', bg: '#1a0505', surface: '#2b0a0a' },
            CYBER: { name: 'CYBERPUNK', brand: '#00ff9d', bg: '#001a11', surface: '#002b1c' },
            AURORA: { name: 'AURORA', brand: '#06b6d4', bg: '#020817', surface: '#05122b' }
        };

        // --- BANCO DE DADOS DE AUTOCOMPLETE EXPANDIDO (+150 ENTRADAS) ---
        const DICTIONARIES = {
            html: [
                'div', 'span', 'section', 'header', 'footer', 'nav', 'main', 'script', 'style', 'input', 'button', 'iframe', 'canvas', 'svg', 'article', 'aside', 'link', 'meta', 'title', 'body', 'html', 'img', 'p', 'h1', 'h2', 'h3', 'h4', 'ul', 'li', 'form', 'label', 'textarea', 'br', 'hr', 'strong', 'em', 'blockquote', 'code', 'pre', 'table', 'thead', 'tbody', 'tr', 'td', 'th', 'a', 'video', 'audio', 'source', 'track', 'option', 'select', 'details', 'summary', 'dialog', 'datalist', 'fieldset', 'legend', 'address', 'figure', 'figcaption', 'time', 'mark', 'del', 'ins', 'sup', 'sub', 'small', 'cite', 'abbr', 'progress', 'meter', 'template', 'slot'
            ],
            css: [
                'background', 'background-color', 'background-image', 'background-size', 'background-position', 'color', 'margin', 'margin-top', 'margin-right', 'margin-bottom', 'margin-left', 'padding', 'padding-top', 'padding-right', 'padding-bottom', 'padding-left', 'display: flex', 'display: grid', 'display: block', 'display: inline-block', 'display: none', 'justify-content', 'align-items', 'flex-direction', 'flex-wrap', 'flex-grow', 'grid-template-columns', 'grid-template-rows', 'gap', 'border', 'border-radius', 'border-color', 'position', 'top', 'left', 'right', 'bottom', 'width', 'height', 'min-width', 'max-width', 'min-height', 'max-height', 'box-shadow', 'opacity', 'transition', 'transform', 'translate', 'scale', 'rotate', 'skew', 'z-index', 'overflow', 'overflow-x', 'overflow-y', 'font-size', 'font-weight', 'font-family', 'text-align', 'text-decoration', 'text-transform', 'line-height', 'letter-spacing', 'cursor', 'pointer-events', 'user-select', 'white-space', 'word-break', 'filter', 'backdrop-filter', 'clip-path', 'mask-image'
            ],
            js: [
                'console.log', 'document.querySelector', 'document.getElementById', 'document.createElement', 'document.body.appendChild', 'addEventListener', 'removeEventListener', 'fetch', 'setTimeout', 'setInterval', 'clearTimeout', 'clearInterval', 'localStorage.setItem', 'localStorage.getItem', 'localStorage.removeItem', 'JSON.parse', 'JSON.stringify', 'window.location', 'window.innerWidth', 'window.innerHeight', 'navigator.clipboard', 'Math.random', 'Math.floor', 'Math.ceil', 'Math.round', 'Math.max', 'Math.min', 'new Date', 'const', 'let', 'var', 'async', 'await', 'return', 'if', 'else', 'switch', 'case', 'break', 'default', 'try', 'catch', 'finally', 'throw', 'function', 'class', 'extends', 'constructor', 'this', 'super', 'import', 'export', 'from', 'map', 'filter', 'reduce', 'forEach', 'find', 'includes', 'push', 'pop', 'shift', 'unshift', 'slice', 'splice', 'join', 'split', 'replace', 'toLowerCase', 'toUpperCase', 'trim', 'length', 'Object.keys', 'Object.values', 'Object.entries', 'Promise.all', 'Promise.resolve', 'Promise.reject'
            ]
        };

        // --- UTILIT√ÅRIOS ---
        const Icon = ({ name, size = 20, className = "" }) => {
            useEffect(() => { 
                if (window.lucide) window.lucide.createIcons(); 
            }, [name]);
            return <i data-lucide={name} style={{ width: size, height: size }} className={className}></i>;
        };

        // ==========================================
        // M√ìDULO 1: GATEWAY (MODO VISITANTE / OFFLINE FIRST)
        // Otimizado para persist√™ncia extrema (PWA-Like)
        // ==========================================
        const Gateway = ({ nodeId }) => {
            const [status, setStatus] = useState('INIT'); // INIT, CONNECTING, RECEIVING, RENDER, ERROR, OFFLINE_MODE
            const [errorMsg, setErrorMsg] = useState('');
            const [siteData, setSiteData] = useState(null);
            const [progress, setProgress] = useState(0);

            useEffect(() => {
                // VERIFICA√á√ÉO INSTANT√ÇNEA DE OFFLINE/CACHE
                const cached = localStorage.getItem(`onxy_cache_${nodeId}`);
                
                // Se estiver offline ou se a conex√£o falhar, tenta o cache IMEDIATAMENTE
                if (!navigator.onLine && cached) {
                    console.log('[GATEWAY] Offline detectado. Carregando mem√≥ria persistente.');
                    setSiteData(JSON.parse(cached));
                    setStatus('RENDER');
                    return;
                }

                // 1. Iniciar conex√£o
                setStatus('CONNECTING');
                const peer = new Peer(); 

                peer.on('open', (myId) => {
                    console.log(`[GATEWAY] Client initialized: ${myId}`);
                    setProgress(20);

                    // 2. Conectar ao Host
                    const conn = peer.connect(nodeId);

                    conn.on('open', () => {
                        console.log(`[GATEWAY] Connected to Host: ${nodeId}`);
                        setStatus('RECEIVING');
                        setProgress(50);
                        conn.send({ type: 'GET_DEPLOY_PACKET' });
                    });

                    conn.on('data', (data) => {
                        if (data.type === 'DEPLOY_PACKET') {
                            console.log('[GATEWAY] Pacote recebido.');
                            setProgress(90);
                            setSiteData(data.files);
                            // PERSIST√äNCIA: Salva imediatamente no LocalStorage
                            localStorage.setItem(`onxy_cache_${nodeId}`, JSON.stringify(data.files));
                            
                            setTimeout(() => {
                                setProgress(100);
                                setStatus('RENDER');
                            }, 500);
                        }
                    });

                    conn.on('close', () => {
                        console.warn('[GATEWAY] Conex√£o fechada.');
                        // Se cair a conex√£o mas tiver cache, mant√©m o site
                        if (status !== 'RENDER' && cached) {
                             setSiteData(JSON.parse(cached));
                             setStatus('RENDER');
                        }
                    });

                    conn.on('error', (err) => {
                        console.error('[GATEWAY] Connection Error:', err);
                        if (cached) {
                            setSiteData(JSON.parse(cached));
                            setStatus('RENDER');
                        } else {
                            setStatus('ERROR');
                            setErrorMsg('Host offline e sem cache local.');
                        }
                    });
                });

                peer.on('error', (err) => {
                    if (cached) {
                        setSiteData(JSON.parse(cached));
                        setStatus('RENDER');
                    } else {
                        setStatus('ERROR');
                        setErrorMsg('Falha WebRTC cr√≠tica.');
                    }
                });

                // Timeout de seguran√ßa - Fallback agressivo para cache
                setTimeout(() => {
                    if ((status === 'CONNECTING' || status === 'INIT') && cached) {
                        console.log('[GATEWAY] Timeout. Usando vers√£o em cache.');
                        setSiteData(JSON.parse(cached));
                        setStatus('RENDER');
                    } else if ((status === 'CONNECTING' || status === 'INIT') && !cached) {
                         setStatus('ERROR');
                         setErrorMsg('Tempo limite excedido. Servidor n√£o responde.');
                    }
                }, 8000);

                return () => peer.destroy();
            }, [nodeId]);

            // Constr√≥i o HTML final
            const buildSite = () => {
                if (!siteData) return '';
                const html = siteData.find(f => f.name.endsWith('.html'))?.content || '<h1>404 - No Entry Point</h1>';
                const css = siteData.find(f => f.name.endsWith('.css'))?.content || '';
                const js = siteData.find(f => f.name.endsWith('.js'))?.content || '';

                return `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="utf-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1">
                        <style>
                            ${css}
                        </style>
                    </head>
                    <body>
                        ${html}
                        <script>
                            try {
                                ${js}
                            } catch(e) { console.error("Runtime Error:", e); }
                        <\/script>
                    </body>
                    </html>
                `;
            };

            // RENDERIZA√á√ÉO DO GATEWAY
            if (status === 'RENDER') {
                return (
                    <div className="gateway-container">
                        <iframe 
                            srcDoc={buildSite()} 
                            className="gateway-iframe" 
                            title="Onxy Deployment"
                            sandbox="allow-scripts allow-forms allow-modals allow-popups allow-same-origin"
                        />
                        <div style={{ position: 'fixed', bottom: 10, right: 10, zIndex: 9999, opacity: 0.5 }} className="hover:opacity-100 transition-opacity">
                            <a href="/" target="_blank" className="flex items-center gap-2 bg-black text-white px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest border border-white/20 shadow-lg">
                                <div className={`w-2 h-2 rounded-full animate-pulse ${!navigator.onLine ? 'bg-yellow-500' : 'bg-[#a855f7]'}`}></div>
                                {!navigator.onLine ? 'OFFLINE MODE' : 'ONXY CLOUD'}
                            </a>
                        </div>
                    </div>
                );
            }

            return (
                <div className="flex flex-col items-center justify-center h-screen bg-[#030303] text-white relative overflow-hidden">
                    <div className="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20"></div>
                    
                    <div className="z-10 w-full max-w-sm p-8 flex flex-col items-center">
                        <div className="w-16 h-16 bg-[#a855f7]/10 rounded-2xl flex items-center justify-center mb-6 ring-1 ring-[#a855f7]/30 shadow-[0_0_30px_rgba(168,85,247,0.3)]">
                            <Icon name="cloud" size={32} className="text-[#a855f7]" />
                        </div>
                        
                        <h1 className="text-2xl font-black uppercase italic tracking-tighter mb-2">ONXY <span className="text-[#a855f7]">Entery</span></h1>
                        
                        {status === 'ERROR' ? (
                            <div className="text-center space-y-4 animate-[fadeIn_0.5s]">
                                <div className="p-4 bg-red-500/10 border border-red-500/20 rounded-xl">
                                    <p className="text-red-400 text-xs font-mono font-bold mb-1">CONEX√ÉO FALHOU</p>
                                    <p className="text-gray-400 text-[10px]">{errorMsg}</p>
                                </div>
                                <button onClick={() => window.location.reload()} className="px-6 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-xs font-bold uppercase transition-all">
                                    Tentar Novamente
                                </button>
                            </div>
                        ) : (
                            <div className="w-full space-y-4 animate-[fadeIn_0.5s]">
                                <div className="flex justify-between text-[10px] font-mono text-gray-500 uppercase tracking-widest">
                                    <span>{status === 'INIT' ? 'INITIALIZING' : status === 'CONNECTING' ? 'LOOKING FOR HOST' : 'SYNCING DATA'}</span>
                                    <span>{progress}%</span>
                                </div>
                                <div className="h-1 bg-white/10 rounded-full overflow-hidden">
                                    <div className="h-full bg-[#a855f7] transition-all duration-300" style={{ width: `${progress}%` }}></div>
                                </div>
                                <p className="text-center text-[10px] text-gray-600 font-mono">Target Node: {nodeId.substring(0,8)}...</p>
                            </div>
                        )}
                    </div>
                    
                    <div className="absolute bottom-8 text-[9px] text-gray-700 uppercase tracking-[0.4em]">Decentralized Content Delivery</div>
                </div>
            );
        };

        // ==========================================
        // M√ìDULO 2: IDE (MODO DESENVOLVEDOR)
        // O c√≥digo complexo original, com melhorias
        // ==========================================
        
        const BootSequence = ({ onComplete }) => {
            const [text, setText] = useState("BIOS CHECK...");
            
            useEffect(() => {
                const seq = [
                    { t: 0, msg: "INITIALIZING KERNEL..." },
                    { t: 800, msg: "MOUNTING VIRTUAL FILESYSTEM..." },
                    { t: 1500, msg: "LOADING UI MODULES..." },
                    { t: 2200, msg: "ESTABLISHING SECURE CONTEXT..." },
                    { t: 2800, msg: "SYSTEM READY" }
                ];
                
                seq.forEach(({t, msg}) => setTimeout(() => setText(msg), t));
                setTimeout(onComplete, 3200);
            }, []);

            return (
                <div className="boot-screen">
                    <div className="w-16 h-16 border-4 border-t-transparent border-[var(--brand)] rounded-full animate-spin mb-6"></div>
                    <div className="boot-loader w-64 h-1 bg-gray-900 rounded-full overflow-hidden mb-4">
                        <div className="boot-bar"></div>
                    </div>
                    <div className="text-[var(--brand)] text-xs font-bold tracking-[0.2em] animate-pulse">{text}</div>
                    <div className="absolute bottom-10 text-gray-600 text-[9px]">ONXY PRO BUILD v3.5.0-RELEASE</div>
                </div>
            );
        };

        const IDE = () => {
            // STATES PRINCIPAIS
            const [view, setView] = useState('HOME');
            const [projects, setProjects] = useState(() => {
                try { return JSON.parse(localStorage.getItem('onxy_pro_v3_db') || '[]'); } catch { return []; }
            });
            const [theme, setTheme] = useState(() => localStorage.getItem('onxy_theme_v3') || 'VOID');
            const [activeId, setActiveId] = useState(null);
            const [activeFileIdx, setActiveFileIdx] = useState(0);
            
            // UTILITIES STATES
            const [suggestions, setSuggestions] = useState([]);
            const [ram, setRam] = useState(0);
            const [isOnline, setIsOnline] = useState(false);
            const [logs, setLogs] = useState([]);
            const [booted, setBooted] = useState(false);
            const [autoIndex, setAutoIndex] = useState(true);
            const [peerId, setPeerId] = useState(null);
            const [connectedPeers, setConnectedPeers] = useState(0);

            // SISTEMAS DE KEEPALIVE
            const peerRef = useRef(null);
            const audioCtxRef = useRef(null);
            const oscillatorRef = useRef(null);
            const wakeLockRef = useRef(null);

            const activeProject = useMemo(() => projects.find(p => p.id === activeId), [projects, activeId]);

            // INICIALIZA√á√ÉO E EFEITOS
            useEffect(() => {
                localStorage.setItem('onxy_pro_v3_db', JSON.stringify(projects));
                localStorage.setItem('onxy_theme_v3', theme);
                
                // Aplica√ß√£o do tema
                const t = THEMES[theme];
                const root = document.documentElement;
                root.style.setProperty('--brand', t.brand);
                root.style.setProperty('--brand-glow', `${t.brand}80`);
                root.style.setProperty('--bg', t.bg);
                root.style.setProperty('--surface', t.surface);
                document.body.style.background = t.bg;
                
                // Meta theme color update
                document.querySelector('meta[name="theme-color"]').setAttribute('content', t.bg);
            }, [projects, theme]);

            // SIMULA√á√ÉO DE RECURSOS DE HARDWARE
            useEffect(() => {
                const interval = setInterval(() => {
                    const usage = window.performance?.memory ? (window.performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(1) : (Math.random() * 15 + 45).toFixed(1);
                    setRam(usage);
                }, 2000);
                return () => clearInterval(interval);
            }, []);

            const addLog = (msg, type = 'info') => {
                const icon = type === 'success' ? '‚úî' : type === 'warn' ? '‚ö†' : type === 'net' ? 'üåê' : '‚Ñπ';
                const id = Math.random().toString(36).substr(2, 9);
                setLogs(prev => [{ id, msg, type, time: new Date().toLocaleTimeString(), icon }, ...prev].slice(0, 100));
            };

            // --- SISTEMA DE KEEPALIVE AVAN√áADO ---
            const enableKeepAlive = async () => {
                // 1. Wake Lock API (Impede tela de desligar)
                try {
                    if ('wakeLock' in navigator) {
                        wakeLockRef.current = await navigator.wakeLock.request('screen');
                        addLog('Wake Lock Ativo: Tela e CPU mantidas em alta prioridade.', 'success');
                    }
                } catch (err) {
                    addLog('Wake Lock n√£o suportado ou negado.', 'warn');
                }

                // 2. Oscilador de √Åudio Perp√©tuo (Mant√©m thread de √°udio ativa)
                try {
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    if (AudioContext) {
                        if (!audioCtxRef.current) audioCtxRef.current = new AudioContext();
                        
                        // Cria um oscilador silencioso (som inaud√≠vel, mas processado)
                        const osc = audioCtxRef.current.createOscillator();
                        const gain = audioCtxRef.current.createGain();
                        
                        osc.type = 'sine';
                        osc.frequency.setValueAtTime(1, audioCtxRef.current.currentTime); // 1Hz (inaud√≠vel)
                        gain.gain.setValueAtTime(0.001, audioCtxRef.current.currentTime); // Volume quase zero
                        
                        osc.connect(gain);
                        gain.connect(audioCtxRef.current.destination);
                        osc.start();
                        
                        oscillatorRef.current = osc;
                        addLog('Audio Thread Keep-Alive: Ativado (Oscilador Perp√©tuo).', 'success');
                    }
                } catch (e) {
                    console.error(e);
                    addLog('Falha ao iniciar Audio Keep-Alive.', 'warn');
                }
            };

            const disableKeepAlive = () => {
                if (wakeLockRef.current) {
                    wakeLockRef.current.release();
                    wakeLockRef.current = null;
                }
                if (oscillatorRef.current) {
                    oscillatorRef.current.stop();
                    oscillatorRef.current = null;
                }
                addLog('Modo de economia de energia restaurado.', 'info');
            };

            // L√ìGICA DE EDITOR E SUGEST√ïES
            const handleCodeChange = (val) => {
                const updatedProjects = projects.map(p => {
                    if (p.id === activeId) {
                        const newFiles = [...p.files];
                        newFiles[activeFileIdx].content = val;
                        return { ...p, files: newFiles, lastModified: Date.now() };
                    }
                    return p;
                });
                setProjects(updatedProjects);

                if (!autoIndex) { setSuggestions([]); return; }

                // L√≥gica de IntelliSense Simples
                const cursorIndex = val.length; 
                const textBeforeCursor = val; 
                const words = textBeforeCursor.split(/[\s<>.(){}=;'"/]/);
                const lastWord = words.pop().toLowerCase();
                const fileExt = activeProject?.files[activeFileIdx].name.split('.').pop() || 'html';

                if (lastWord.length >= 2) {
                    const dict = DICTIONARIES[fileExt] || [];
                    const matches = dict.filter(w => w.toLowerCase().startsWith(lastWord)).slice(0, 8);
                    setSuggestions(matches);
                } else {
                    setSuggestions([]);
                }
            };

            const applySuggestion = (sug) => {
                const content = activeProject.files[activeFileIdx].content;
                const words = content.split(/([\s<>.(){}=;'"/])/);
                let lastWordIndex = -1;
                
                for(let i = words.length - 1; i >= 0; i--) {
                    if(!/[\s<>.(){}=;'"/]/.test(words[i]) && words[i].trim().length > 0) {
                        lastWordIndex = i;
                        break;
                    }
                }

                if(lastWordIndex !== -1) {
                    words[lastWordIndex] = sug;
                    const newContent = words.join('');
                    handleCodeChange(newContent);
                    setSuggestions([]);
                }
            };

            // L√ìGICA WEBRTC (HOSTING)
            const toggleServer = () => {
                if (isOnline) {
                    peerRef.current?.destroy();
                    setIsOnline(false);
                    setPeerId(null);
                    setConnectedPeers(0);
                    disableKeepAlive(); // Desliga o keep-alive
                    addLog('Servidor WebRTC desligado.', 'warn');
                } else {
                    // Tenta manter o ID consistente
                    const deterministicId = `onxy-${activeId}`;
                    const peer = new Peer(deterministicId);
                    
                    addLog('Inicializando handshake...', 'info');

                    peer.on('open', (id) => {
                        setIsOnline(true);
                        setPeerId(id);
                        addLog(`Servidor Online! ID: ${id}`, 'success');
                        enableKeepAlive(); // Ativa o keep-alive supremo
                        document.getElementById('silent-audio').play().catch(()=>{});
                    });

                    peer.on('connection', (conn) => {
                        addLog(`Nova conex√£o de entrada: ${conn.peer}`, 'net');
                        setConnectedPeers(prev => prev + 1);

                        conn.on('data', (data) => {
                            if (data.type === 'GET_DEPLOY_PACKET') {
                                addLog(`Enviando bundle para ${conn.peer}...`, 'info');
                                conn.send({ 
                                    type: 'DEPLOY_PACKET', 
                                    files: activeProject.files 
                                });
                                addLog(`Bundle transmitido (Size: ${(JSON.stringify(activeProject.files).length / 1024).toFixed(2)}KB)`, 'success');
                            }
                        });

                        conn.on('close', () => {
                            setConnectedPeers(prev => Math.max(0, prev - 1));
                            addLog(`Conex√£o ${conn.peer} encerrada.`, 'warn');
                        });
                    });

                    peer.on('error', (err) => {
                        addLog(`Erro P2P: ${err.type}`, 'warn');
                        if (err.type === 'unavailable-id') {
                            addLog('ID ocupado, use outro projeto ou espere.', 'info');
                        } else {
                            setIsOnline(false);
                        }
                    });

                    peerRef.current = peer;
                }
            };

            const copyDeployLink = () => {
                if (!isOnline || !peerId) return alert('Inicie o servidor primeiro!');
                const url = `${window.location.origin}${window.location.pathname}?live=${peerId}`;
                
                const el = document.createElement('textarea');
                el.value = url;
                document.body.appendChild(el);
                el.select();
                document.execCommand('copy');
                document.body.removeChild(el);
                
                addLog('Link de Deploy copiado!', 'success');
            };

            // RENDERIZA√á√ÉO DA UI DA IDE
            if (!booted) return <BootSequence onComplete={() => setBooted(true)} />;

            return (
                <div className="flex flex-col h-screen relative">
                    {/* CABE√áALHO */}
                    <header className="h-16 flex items-center justify-between px-6 glass shrink-0 relative z-20">
                        <div className="flex items-center gap-3 cursor-pointer group" onClick={() => setView('HOME')}>
                            <div className="w-9 h-9 bg-[var(--brand)]/20 rounded-xl flex items-center justify-center border border-[var(--brand)]/30 group-hover:scale-105 transition-transform shadow-[0_0_15px_var(--brand-glow)]">
                                <Icon name="cloud" size={18} className="text-[var(--brand)] fill-current" />
                            </div>
                            <div className="flex flex-col">
                                <span className="font-black uppercase italic tracking-tighter text-sm leading-none">ONXY <span className="text-[var(--brand)]">CLOUD</span></span>
                                <span className="text-[8px] text-gray-500 font-mono tracking-widest mt-0.5">ONXY ACTIVE</span>
                            </div>
                        </div>
                        
                        <div className="flex items-center gap-6">
                            {/* Theme Selector Compacto */}
                            <div className="flex bg-white/5 p-1 rounded-full border border-white/5">
                                {Object.keys(THEMES).map(t => (
                                    <button 
                                        key={t} 
                                        onClick={() => setTheme(t)} 
                                        className={`w-3 h-3 rounded-full mx-1 transition-all ${theme === t ? 'scale-125 ring-2 ring-white' : 'opacity-40 hover:opacity-100'}`} 
                                        style={{ background: THEMES[t].brand }} 
                                        title={THEMES[t].name}
                                    />
                                ))}
                            </div>
                            
                            <div className="flex flex-col items-end">
                                <span className="text-[7px] font-black text-gray-500 tracking-widest uppercase leading-none">V-MEM</span>
                                <span className="text-[11px] font-mono text-[var(--brand)] font-bold">{ram} MB</span>
                            </div>
                        </div>
                    </header>

                    {/* CORPO PRINCIPAL */}
                    <main className="flex-1 overflow-y-auto hide-scroll pb-24 relative z-10">
                        
                        {/* VIEW: HOME DASHBOARD */}
                        {view === 'HOME' && (
                            <div className="p-8 max-w-5xl mx-auto space-y-10 animate-[fadeIn_0.5s]">
                                <div className="text-center space-y-4 py-12 scanner rounded-[2rem] bg-gradient-to-b from-white/5 to-transparent border border-white/5 relative overflow-hidden">
                                    <div className="absolute top-0 right-0 p-20 opacity-5 pointer-events-none">
                                        <Icon name="cpu" size={200} />
                                    </div>
                                    <h1 className="text-6xl md:text-8xl font-black uppercase italic leading-none tracking-tighter">
                                        CODE <span className="text-transparent bg-clip-text bg-gradient-to-r from-[var(--brand)] to-white">LESS</span><br/>
                                        DEPLOY <span className="text-[var(--brand)]">MORE</span>
                                    </h1>
                                    <p className="text-gray-500 text-[10px] font-bold uppercase tracking-[0.4em]">Decentralized WebRTC Development Environment</p>
                                    
                                    <div className="flex justify-center gap-4 mt-8">
                                        <button onClick={() => setView('DASHBOARD')} className="px-8 py-4 bg-[var(--brand)] rounded-xl font-black text-xs uppercase tracking-[0.2em] shadow-[0_10px_40px_-10px_var(--brand-glow)] hover:scale-105 active:scale-95 transition-all text-black flex items-center gap-2">
                                            <Icon name="terminal" size={16} /> Open Console
                                        </button>
                                        <a href="https://github.com/topics/webrtc" target="_blank" className="px-8 py-4 bg-white/5 border border-white/10 rounded-xl font-black text-xs uppercase tracking-[0.2em] hover:bg-white/10 transition-all flex items-center gap-2">
                                            <Icon name="book" size={16} /> Docs
                                        </a>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div className="glass-panel p-6 rounded-2xl space-y-3 hover:-translate-y-1 transition-transform duration-300">
                                        <div className="w-10 h-10 rounded-lg bg-[var(--brand)]/10 flex items-center justify-center text-[var(--brand)]"><Icon name="zap" /></div>
                                        <h3 className="text-xs font-black uppercase tracking-wider">Instant Deploy</h3>
                                        <p className="text-[10px] text-gray-500 leading-relaxed">Sem servidores. Sem configura√ß√µes. Seu navegador √© o host. O link gerado abre diretamente o site.</p>
                                    </div>
                                    <div className="glass-panel p-6 rounded-2xl space-y-3 hover:-translate-y-1 transition-transform duration-300">
                                        <div className="w-10 h-10 rounded-lg bg-[var(--brand)]/10 flex items-center justify-center text-[var(--brand)]"><Icon name="shield" /></div>
                                        <h3 className="text-xs font-black uppercase tracking-wider">P2P Security</h3>
                                        <p className="text-[10px] text-gray-500 leading-relaxed">Arquitetura de Gateway separada. Visitantes veem apenas o resultado compilado, nunca o c√≥digo fonte da IDE.</p>
                                    </div>
                                    <div className="glass-panel p-6 rounded-2xl flex items-center justify-between hover:-translate-y-1 transition-transform duration-300">
                                        <div className="space-y-3">
                                            <div className="w-10 h-10 rounded-lg bg-[var(--brand)]/10 flex items-center justify-center text-[var(--brand)]"><Icon name="wand-2" /></div>
                                            <h3 className="text-xs font-black uppercase tracking-wider">Auto-Index</h3>
                                            <p className="text-[10px] text-gray-500">Sugest√µes inteligentes.</p>
                                        </div>
                                        <div className={`switch-ui ${autoIndex ? 'active' : ''}`} onClick={() => setAutoIndex(!autoIndex)}></div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* VIEW: PROJECT DASHBOARD */}
                        {view === 'DASHBOARD' && (
                            <div className="p-6 space-y-8 animate-[fadeIn_0.3s]">
                                <div className="flex justify-between items-center bg-white/5 p-6 rounded-3xl border border-white/5">
                                    <div>
                                        <h2 className="text-2xl font-black uppercase italic mb-1">Meus Reposit√≥rios</h2>
                                        <div className="flex gap-2">
                                            <span className="tag">{projects.length} PROJETOS</span>
                                            <span className="tag">{isOnline ? 'ONLINE' : 'OFFLINE'}</span>
                                        </div>
                                    </div>
                                    <button onClick={() => {
                                        const n = prompt("Nome do Projeto:");
                                        if(n) {
                                            const id = n.toLowerCase().replace(/\s/g, '-') + '-' + Math.random().toString(36).substr(2,4);
                                            const newProj = { 
                                                id, 
                                                name: n.toUpperCase(), 
                                                lastModified: Date.now(), 
                                                files: [
                                                    { name: 'index.html', content: '<!-- Start Coding -->\n<h1 class="title">Hello World</h1>' },
                                                    { name: 'style.css', content: '.title { color: violet; font-family: sans-serif; text-align: center; margin-top: 20%; }' },
                                                    { name: 'script.js', content: 'console.log("System Ready");' }
                                                ] 
                                            };
                                            setProjects([newProj, ...projects]);
                                            setActiveId(id); setView('EDITOR');
                                        }
                                    }} className="bg-[var(--brand)] w-12 h-12 rounded-full flex items-center justify-center text-black hover:scale-110 transition-transform shadow-[0_0_20px_var(--brand-glow)]">
                                        <Icon name="plus" size={24} strokeWidth={3} />
                                    </button>
                                </div>

                                <div className="grid gap-4">
                                    {projects.map(p => {
                                        const totalSize = p.files.reduce((acc, f) => acc + f.content.length, 0);
                                        return (
                                            <div key={p.id} onClick={() => { setActiveId(p.id); setView('EDITOR'); }} className="glass-panel p-6 rounded-[2rem] group transition-all active:scale-[0.98] cursor-pointer hover:border-[var(--brand)]/50 relative overflow-hidden">
                                                <div className="absolute right-0 top-0 p-8 opacity-0 group-hover:opacity-10 transition-opacity transform group-hover:rotate-12">
                                                    <Icon name="code-2" size={100} />
                                                </div>
                                                <div className="flex justify-between items-start mb-6 relative z-10">
                                                    <div className="flex gap-5">
                                                        <div className="w-14 h-14 bg-white/5 rounded-2xl flex items-center justify-center text-[var(--brand)] border border-white/5 group-hover:bg-[var(--brand)] group-hover:text-black transition-colors duration-300">
                                                            <Icon name="box" size={24} />
                                                        </div>
                                                        <div>
                                                            <div className="font-black text-lg italic tracking-tight">{p.name}</div>
                                                            <div className="flex gap-2 mt-2">
                                                                <span className="tag">{p.files.length} FILES</span>
                                                                <span className="tag">{(totalSize/1024).toFixed(2)} KB</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <button onClick={(e) => { e.stopPropagation(); if(confirm("Deletar projeto permanentemente?")) { setProjects(projects.filter(x => x.id !== p.id)); if(activeId === p.id) setActiveId(null); } }} className="p-3 text-gray-600 hover:text-red-500 transition-colors bg-white/5 rounded-xl hover:bg-white/10">
                                                        <Icon name="trash-2" size={18} />
                                                    </button>
                                                </div>
                                                <div className="flex justify-between items-center text-[9px] text-gray-500 font-mono relative z-10 pt-4 border-t border-white/5">
                                                    <span>UID: {p.id}</span>
                                                    <span>UPDATED: {new Date(p.lastModified).toLocaleDateString()}</span>
                                                </div>
                                            </div>
                                        );
                                    })}
                                    {projects.length === 0 && <div className="text-center py-20 text-gray-700 font-mono text-xs uppercase tracking-widest">Nenhum projeto inicializado.</div>}
                                </div>
                            </div>
                        )}

                        {/* VIEW: EDITOR IDE */}
                        {view === 'EDITOR' && activeProject && (
                            <div className="h-full flex flex-col animate-[fadeIn_0.3s]">
                                {/* TABS DO EDITOR */}
                                <div className="flex bg-[#0a0a0a] border-b border-white/5 overflow-x-auto hide-scroll shrink-0">
                                    {activeProject.files.map((f, i) => (
                                        <div key={i} className={`flex items-center gap-2 px-6 py-4 border-r border-white/5 transition-all cursor-pointer min-w-[120px] justify-between ${activeFileIdx === i ? 'bg-[var(--brand)]/5 text-[var(--brand)] border-b-2 border-b-[var(--brand)]' : 'text-gray-500 hover:text-gray-300 hover:bg-white/5'}`}>
                                            <button onClick={() => setActiveFileIdx(i)} className="text-[10px] font-mono font-bold uppercase truncate">{f.name}</button>
                                            {activeFileIdx === i && <button onClick={() => {
                                                if(activeProject.files.length <= 1) return;
                                                const newPs = projects.map(p => p.id === activeId ? {...p, files: p.files.filter((_, idx) => idx !== i)} : p);
                                                setProjects(newPs); setActiveFileIdx(0);
                                            }} className="hover:text-red-500"><Icon name="x" size={12}/></button>}
                                        </div>
                                    ))}
                                    <button onClick={() => {
                                        const fn = prompt("Nome do arquivo (ex: script.js):");
                                        if(fn) {
                                            const newPs = projects.map(p => p.id === activeId ? {...p, files: [...p.files, {name: fn, content: ''}]} : p);
                                            setProjects(newPs); setActiveFileIdx(activeProject.files.length);
                                        }
                                    }} className="px-6 flex items-center justify-center text-[var(--brand)] hover:bg-white/5 transition-colors border-r border-white/5"><Icon name="plus" size={16}/></button>
                                </div>
                                
                                {/* √ÅREA DE C√ìDIGO */}
                                <div className="flex-1 relative bg-[#050505]">
                                    <div className="absolute top-0 left-0 bottom-0 w-10 border-r border-white/5 bg-[#0a0a0a] text-gray-700 font-mono text-[10px] flex flex-col items-center py-4 select-none">
                                        {Array.from({length: 20}).map((_, i) => <div key={i} className="mb-1 opacity-50">{i+1}</div>)}
                                    </div>
                                    <textarea 
                                        className="editor-area w-full h-full pl-14 pr-4 py-4 resize-none"
                                        value={activeProject.files[activeFileIdx].content}
                                        onChange={(e) => handleCodeChange(e.target.value)}
                                        spellCheck="false"
                                        autoComplete="off"
                                        placeholder="// Escreva seu c√≥digo aqui..."
                                    />
                                    
                                    {/* SUGEST√ïES DE AUTOCOMPLETE */}
                                    {suggestions.length > 0 && (
                                        <div className="suggestion-box">
                                            {suggestions.map(s => (
                                                <div key={s} className="suggestion-item" onClick={() => applySuggestion(s)}>
                                                    <span>{s}</span>
                                                    <span className="text-[var(--brand)] opacity-50 text-[9px] font-bold border border-[var(--brand)] px-1 rounded">TAB</span>
                                                </div>
                                            ))}
                                        </div>
                                    )}

                                    {/* RODAP√â DO EDITOR */}
                                    <div className="absolute bottom-0 left-0 right-0 h-6 bg-[#0a0a0a] border-t border-white/5 flex items-center px-4 justify-between text-[9px] font-mono text-gray-500 select-none">
                                        <div className="flex gap-4">
                                            <span>UTF-8</span>
                                            <span>{activeProject.files[activeFileIdx].name.split('.').pop().toUpperCase()}</span>
                                        </div>
                                        <div>Ln {activeProject.files[activeFileIdx].content.split('\n').length}, Col {activeProject.files[activeFileIdx].content.length}</div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* VIEW: DEPLOY / NETWORK CENTER */}
                        {view === 'NETWORK' && activeProject && (
                            <div className="p-6 space-y-6 h-full flex flex-col animate-[fadeIn_0.3s]">
                                <div className={`glass-panel p-8 rounded-[3rem] text-center space-y-6 transition-all duration-700 border-2 ${isOnline ? 'border-[var(--brand)] bg-[var(--brand)]/5 shadow-[0_0_50px_rgba(0,0,0,0.5)]' : 'border-transparent'}`}>
                                    <div className="relative inline-block">
                                        <div className={`w-32 h-32 rounded-full flex items-center justify-center transition-all duration-500 ${isOnline ? 'bg-[var(--brand)] text-black shadow-[0_0_60px_var(--brand-glow)]' : 'bg-white/5 text-gray-600 grayscale'}`}>
                                            <Icon name="radio" size={48} className={isOnline ? 'animate-pulse' : ''} />
                                        </div>
                                        {isOnline && <div className="absolute bottom-2 right-2 w-8 h-8 bg-green-500 rounded-full border-4 border-black animate-bounce flex items-center justify-center font-bold text-[10px]">{connectedPeers}</div>}
                                    </div>

                                    <div>
                                        <h3 className="font-black text-xl uppercase italic mb-2 tracking-tight">{isOnline ? 'DEPLOYMENT ATIVO' : 'SERVIDOR PARADO'}</h3>
                                        <p className="text-[10px] text-gray-500 uppercase tracking-widest font-mono">
                                            {isOnline ? `NODE ID: ${peerId}` : 'AGUARDANDO INICIALIZA√á√ÉO'}
                                        </p>
                                        {isOnline && <p className="text-[9px] text-[var(--brand)] mt-2 font-bold animate-pulse">KEEP-ALIVE: ON (WakeLock + Audio Thread)</p>}
                                    </div>

                                    {/* √ÅREA DO LINK "VERCEL-LIKE" */}
                                    {isOnline && (
                                        <div className="max-w-md mx-auto space-y-4 animate-[slideUp_0.4s]">
                                            <div className="p-1 bg-black/40 rounded-2xl border border-[var(--brand)]/30 overflow-hidden flex items-center">
                                                <div className="flex-1 px-4 py-3 font-mono text-[10px] text-[var(--brand)] truncate select-all">
                                                    {window.location.origin}{window.location.pathname}?live={peerId}
                                                </div>
                                                <button onClick={copyDeployLink} className="p-3 bg-[var(--brand)] text-black rounded-xl hover:bg-white transition-colors font-bold text-xs uppercase tracking-wider">
                                                    Copiar
                                                </button>
                                            </div>
                                            <p className="text-[9px] text-gray-500">Este link abre apenas o site compilado, protegendo seu c√≥digo fonte.</p>
                                        </div>
                                    )}

                                    <button onClick={toggleServer} className={`w-full max-w-sm mx-auto py-5 rounded-2xl font-black text-xs uppercase tracking-[0.2em] transition-all shadow-xl ${isOnline ? 'bg-red-500/10 text-red-500 border border-red-500/20 hover:bg-red-500/20' : 'bg-[var(--brand)] text-black hover:scale-105'}`}>
                                        {isOnline ? 'DESLIGAR N√ì' : 'INICIAR BROADCAST'}
                                    </button>
                                </div>

                                <div className="flex-1 glass-panel rounded-[2rem] p-6 border border-white/5 overflow-hidden flex flex-col">
                                    <div className="flex justify-between items-center mb-4 pb-4 border-b border-white/5">
                                        <span className="text-[10px] font-black uppercase text-gray-500 tracking-widest">NETWORK LOGS</span>
                                        <span className="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                                    </div>
                                    <div className="flex-1 overflow-y-auto font-mono text-[10px] space-y-1 pr-2 custom-scroll">
                                        {logs.map(l => (
                                            <div key={l.id} className="log-line animate-[fadeIn_0.2s]">
                                                <span className="log-time opacity-40">[{l.time}]</span>
                                                <span className="mr-2">{l.icon}</span>
                                                <span className={`log-content ${l.type === 'success' ? 'text-green-400' : l.type === 'warn' ? 'text-yellow-400' : l.type === 'net' ? 'text-[var(--brand)]' : 'text-gray-400'}`}>{l.msg}</span>
                                            </div>
                                        ))}
                                        {logs.length === 0 && <div className="text-gray-800 italic text-center py-10">Terminal limpo. Nenhuma atividade.</div>}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* VIEW: PREVIEW LOCAL (EMBEDDED) */}
                        {view === 'PREVIEW' && activeProject && (
                            <div className="h-full flex flex-col bg-[#050505] relative z-[100] animate-[fadeIn_0.3s]">
                                <div className={`px-4 py-3 border-b flex items-center justify-between shrink-0 transition-colors ${isOnline ? 'bg-green-500/5 border-green-500/10' : 'bg-red-500/5 border-red-500/10'}`}>
                                    <div className="flex items-center gap-3 overflow-hidden">
                                        <div className={`w-2 h-2 rounded-full ${isOnline ? 'bg-green-500 animate-pulse' : 'bg-red-500'}`}></div>
                                        <div className="flex flex-col">
                                            <span className="text-[10px] font-bold uppercase tracking-wider text-gray-300">
                                                {isOnline ? 'LIVE BROADCAST' : 'LOCAL ENVIRONMENT'}
                                            </span>
                                            <span className="text-[8px] font-mono text-gray-600 truncate max-w-[200px]">
                                                {isOnline ? `onxy://${peerId}` : 'localhost://virtual-dom'}
                                            </span>
                                        </div>
                                    </div>
                                    <div className="flex gap-2">
                                        <button className="text-gray-600 hover:text-white p-2 hover:bg-white/5 rounded-lg transition-colors" onClick={() => document.getElementById('preview-frame').contentWindow.location.reload()}>
                                            <Icon name="rotate-cw" size={14} />
                                        </button>
                                        <button className="text-gray-600 hover:text-white p-2 hover:bg-white/5 rounded-lg transition-colors" onClick={() => {
                                            const blob = new Blob([activeProject.files.find(f=>f.name.endsWith('.html'))?.content], {type: 'text/html'});
                                            window.open(URL.createObjectURL(blob), '_blank');
                                        }}>
                                            <Icon name="external-link" size={14} />
                                        </button>
                                    </div>
                                </div>

                                <div className="flex-1 relative bg-white overflow-hidden">
                                    <iframe 
                                        id="preview-frame"
                                        srcDoc={`
                                            <!DOCTYPE html>
                                            <html>
                                                <head>
                                                    <meta charset="utf-8">
                                                    <meta name="viewport" content="width=device-width, initial-scale=1">
                                                    <style>
                                                        body { margin: 0; font-family: sans-serif; }
                                                        ::-webkit-scrollbar { width: 8px; }
                                                        ::-webkit-scrollbar-track { background: #f1f1f1; }
                                                        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
                                                        ${activeProject.files.find(f=>f.name.endsWith('.css'))?.content || ''}
                                                    </style>
                                                </head>
                                                <body>
                                                    ${activeProject.files.find(f=>f.name.endsWith('.html'))?.content || ''}
                                                    <script>
                                                        window.onerror = function(msg) { console.error("Preview:", msg); };
                                                        ${activeProject.files.find(f=>f.name.endsWith('.js'))?.content || ''}
                                                    <\/script>
                                                </body>
                                            </html>
                                        `} 
                                        className="w-full h-full border-none block"
                                        title="Preview"
                                        sandbox="allow-scripts allow-modals allow-forms allow-popups allow-same-origin"
                                    />
                                </div>
                            </div>
                        )}
                    </main>

                    {/* BARRA DE NAVEGA√á√ÉO INFERIOR */}
                    <nav className="nav-fixed flex items-center justify-around px-2 pb-safe">
                        <NavBtn active={view === 'DASHBOARD'} onClick={() => setView('DASHBOARD')} icon="box" label="Cloud" />
                        <NavBtn active={view === 'EDITOR'} onClick={() => setView('EDITOR')} icon="code-2" label="IDE" disabled={!activeId} />
                        <NavBtn active={view === 'PREVIEW'} onClick={() => setView('PREVIEW')} icon="smartphone" label="Device" disabled={!activeId} />
                        <NavBtn active={view === 'NETWORK'} onClick={() => setView('NETWORK')} icon="activity" label="Deploy" disabled={!activeId} activeDot={isOnline} />
                        <NavBtn active={view === 'HOME'} onClick={() => setView('HOME')} icon="command" label="Root" />
                    </nav>
                </div>
            );
        };

        const NavBtn = ({ active, onClick, icon, label, disabled, activeDot }) => (
            <button disabled={disabled} onClick={onClick} className={`flex flex-col items-center gap-1.5 flex-1 transition-all active:scale-90 relative group ${disabled ? 'opacity-20 grayscale pointer-events-none' : 'hover:-translate-y-1'} ${active ? 'text-[var(--brand)]' : 'text-gray-500'}`}>
                <div className="relative p-2 rounded-xl transition-colors group-hover:bg-white/5">
                    <Icon name={icon} size={22} className={active ? "stroke-[2.5px]" : "stroke-2"} />
                    {activeDot && <div className="absolute top-1 right-1 w-2.5 h-2.5 bg-green-500 rounded-full border-2 border-[#030303] shadow-[0_0_10px_#22c55e] animate-pulse"></div>}
                </div>
                <span className="text-[8px] uppercase font-black italic tracking-wider group-hover:text-white transition-colors">{label}</span>
                {active && <div className="absolute -bottom-2 w-1 h-1 bg-[var(--brand)] rounded-full shadow-[0_0_10px_var(--brand)]"></div>}
            </button>
        );

        // ==========================================
        // ROOT COMPONENT (ROTEAMENTO)
        // Decide qual app carregar baseado na URL
        // ==========================================
        const AppRoot = () => {
            const [route, setRoute] = useState(null);
            const [targetNode, setTargetNode] = useState(null);

            useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                const liveId = params.get('live');

                if (liveId) {
                    console.log('Detected Gateway Mode. Target:', liveId);
                    setTargetNode(liveId);
                    setRoute('GATEWAY');
                } else {
                    console.log('Detected Host Mode.');
                    setRoute('IDE');
                }
            }, []);

            if (!route) return null; // Loading inicial invis√≠vel

            return (
                <>
                    {route === 'GATEWAY' ? <Gateway nodeId={targetNode} /> : <IDE />}
                </>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AppRoot />);
    </script>
</body>
</html>
